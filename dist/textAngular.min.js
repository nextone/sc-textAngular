!function(n,a){"function"==typeof define&&define.amd?define("textAngular",["rangy","rangy/lib/rangy-selectionsaverestore"],function(e,t){return n["textAngular.name"]=a(e)}):"object"==typeof module&&module.exports?module.exports=a(require("rangy"),require("rangy/lib/rangy-selectionsaverestore")):n.textAngular=a(n.rangy)}(this,function(Q){var n={};angular.module("textAngularSetup",[]).constant("taRegisterTool",function(e,t){if(void 0===t.iconinnerhtml&&(t.iconinnerhtml=""),!e||""===e||n.hasOwnProperty(e))throw"textAngular Error: A unique name is required for a Tool Definition";if(t.display&&(""===t.display||!function(e){try{return 0!==angular.element(e).length}catch(e){return}}(t.display))||!t.display&&!t.buttontext&&!t.iconclass)throw'textAngular Error: Tool Definition for "'+e+'" does not have a valid display/iconclass/buttontext value';n[e]=t}).value("taTools",n).value("taOptions",{keyMappings:[],toolbar:[["h1","h2","h3","h4","h5","h6","p","pre","quote"],["bold","italics","underline","strikeThrough","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight","justifyFull","indent","outdent"],["html","insertImage","insertLink","insertVideo","wordcount","charcount"]],classes:{focussed:"focussed",toolbar:"btn-toolbar",toolbarGroup:"btn-group",toolbarButton:"btn btn-default",toolbarButtonActive:"active",disabled:"disabled",textEditor:"form-control",htmlEditor:"form-control"},defaultTagAttributes:{a:{target:""}},setup:{textEditorSetup:function(e){},htmlEditorSetup:function(e){}},defaultFileDropHandler:function(e,t){var n=new FileReader;return"image"===e.type.substring(0,5)&&(n.onload=function(){""!==n.result&&t("insertImage",n.result,!0)},n.readAsDataURL(e),!0)}}).value("taSelectableElements",["a","img"]).value("taCustomRenderers",[{selector:"img",customAttribute:"ta-insert-video",renderLogic:function(e){var t=angular.element("<iframe></iframe>"),n=e.prop("attributes");angular.forEach(n,function(e){t.attr(e.name,e.value)}),t.attr("src",t.attr("ta-insert-video")),e.replaceWith(t)}}]).value("taTranslations",{html:{tooltip:"Toggle html / Rich Text"},heading:{tooltip:"Heading "},p:{tooltip:"Paragraph"},pre:{tooltip:"Preformatted text"},ul:{tooltip:"Unordered List"},ol:{tooltip:"Ordered List"},quote:{tooltip:"Quote/unquote selection or paragraph"},undo:{tooltip:"Undo"},redo:{tooltip:"Redo"},bold:{tooltip:"Bold"},italic:{tooltip:"Italic"},underline:{tooltip:"Underline"},strikeThrough:{tooltip:"Strikethrough"},justifyLeft:{tooltip:"Align text left"},justifyRight:{tooltip:"Align text right"},justifyFull:{tooltip:"Justify text"},justifyCenter:{tooltip:"Center"},indent:{tooltip:"Increase indent"},outdent:{tooltip:"Decrease indent"},clear:{tooltip:"Clear formatting"},insertImage:{dialogPrompt:"Please enter an image URL to insert",tooltip:"Insert image",hotkey:"the - possibly language dependent hotkey ... for some future implementation"},insertVideo:{tooltip:"Insert video",dialogPrompt:"Please enter a youtube URL to embed"},insertLink:{tooltip:"Insert / edit link",dialogPrompt:"Please enter a URL to insert"},editLink:{reLinkButton:{tooltip:"Relink"},unLinkButton:{tooltip:"Unlink"},targetToggle:{buttontext:"Open in New Window"}},wordcount:{tooltip:"Display words Count"},charcount:{tooltip:"Display characters Count"}}).factory("taToolFunctions",["$window","taTranslations",function(l,i){return{imgOnSelectAction:function(e,t,n){function a(){n.updateTaBindtaTextElement(),n.hidePopover()}e.preventDefault(),n.displayElements.popover.css("width","375px");var e=n.displayElements.popoverContainer,o=(e.empty(),angular.element('<div class="btn-group" style="padding-right: 6px;">')),r=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">100% </button>'),l=(r.on("click",function(e){e.preventDefault(),t.css({width:"100%",height:""}),a()}),angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">50% </button>')),i=(l.on("click",function(e){e.preventDefault(),t.css({width:"50%",height:""}),a()}),angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">25% </button>')),s=(i.on("click",function(e){e.preventDefault(),t.css({width:"25%",height:""}),a()}),angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">Reset</button>')),r=(s.on("click",function(e){e.preventDefault(),t.css({width:"",height:""}),a()}),o.append(r),o.append(l),o.append(i),o.append(s),e.append(o),o=angular.element('<div class="btn-group" style="padding-right: 6px;">'),angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-left"></i></button>')),l=(r.on("click",function(e){e.preventDefault(),t.css("float","left"),t.css("cssFloat","left"),t.css("styleFloat","left"),a()}),angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-right"></i></button>')),i=(l.on("click",function(e){e.preventDefault(),t.css("float","right"),t.css("cssFloat","right"),t.css("styleFloat","right"),a()}),angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-justify"></i></button>')),s=(i.on("click",function(e){e.preventDefault(),t.css("float",""),t.css("cssFloat",""),t.css("styleFloat",""),a()}),o.append(r),o.append(i),o.append(l),e.append(o),o=angular.element('<div class="btn-group">'),angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-trash-o"></i></button>'));s.on("click",function(e){e.preventDefault(),t.remove(),a()}),o.append(s),e.append(o),n.showPopover(t),n.showResizeOverlay(t)},aOnSelectAction:function(e,t,n){e.preventDefault(),n.displayElements.popover.css("width","436px");var e=n.displayElements.popoverContainer,a=(e.empty(),e.css("line-height","28px"),angular.element('<a href="'+t.attr("href")+'" target="_blank">'+t.attr("href")+"</a>")),a=(a.css({display:"inline-block","max-width":"200px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","vertical-align":"middle"}),e.append(a),angular.element('<div class="btn-group pull-right">')),o=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on" title="'+i.editLink.reLinkButton.tooltip+'"><i class="fa fa-edit icon-edit"></i></button>'),o=(o.on("click",function(e){e.preventDefault();e=l.prompt(i.insertLink.dialogPrompt,t.attr("href"));e&&""!==e&&"http://"!==e&&(t.attr("href",e),n.updateTaBindtaTextElement()),n.hidePopover()}),a.append(o),angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on" title="'+i.editLink.unLinkButton.tooltip+'"><i class="fa fa-unlink icon-unlink"></i></button>')),r=(o.on("click",function(e){e.preventDefault(),t.replaceWith(t.contents()),n.updateTaBindtaTextElement(),n.hidePopover()}),a.append(o),angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on">'+i.editLink.targetToggle.buttontext+"</button>"));"_blank"===t.attr("target")&&r.addClass("active"),r.on("click",function(e){e.preventDefault(),t.attr("target","_blank"===t.attr("target")?"":"_blank"),r.toggleClass("active"),n.updateTaBindtaTextElement()}),a.append(r),e.append(a),n.showPopover(t)},extractYoutubeVideoId:function(e){e=e.match(/(?:youtube(?:-nocookie)?\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/i);return e&&e[1]||null}}}]).run(["taRegisterTool","$window","taTranslations","taSelection","taToolFunctions","$sanitize","taOptions","$log",function(n,t,a,i,o,e,r,l){function s(){return this.$editor().wrapSelection("formatBlock","<"+this.name.toUpperCase()+">")}function d(e){return-1!==e.toLowerCase().indexOf("javascript")}e("",{}),n("html",{iconclass:"fa fa-code",tooltiptext:a.html.tooltip,action:function(){this.$editor().switchView()},activeState:function(){return this.$editor().showHtml}}),angular.forEach(["h1","h2","h3","h4","h5","h6"],function(e){var t;n(e.toLowerCase(),{buttontext:e.toUpperCase(),tooltiptext:a.heading.tooltip+e.charAt(1),action:s,activeState:(t=e.toLowerCase(),function(){return this.$editor().queryFormatBlockState(t)})})}),n("p",{buttontext:"P",tooltiptext:a.p.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<P>")},activeState:function(){return this.$editor().queryFormatBlockState("p")}}),n("pre",{buttontext:"pre",tooltiptext:a.pre.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<PRE>")},activeState:function(){return this.$editor().queryFormatBlockState("pre")}}),n("ul",{iconclass:"fa fa-list-ul",tooltiptext:a.ul.tooltip,action:function(){return this.$editor().wrapSelection("insertUnorderedList",null)},activeState:function(){return this.$editor().queryCommandState("insertUnorderedList")}}),n("ol",{iconclass:"fa fa-list-ol",tooltiptext:a.ol.tooltip,action:function(){return this.$editor().wrapSelection("insertOrderedList",null)},activeState:function(){return this.$editor().queryCommandState("insertOrderedList")}}),n("quote",{iconclass:"fa fa-quote-right",tooltiptext:a.quote.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<BLOCKQUOTE>")},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")}}),n("undo",{iconclass:"fa fa-undo",tooltiptext:a.undo.tooltip,action:function(){return this.$editor().wrapSelection("undo",null)}}),n("redo",{iconclass:"fa fa-repeat",tooltiptext:a.redo.tooltip,action:function(){return this.$editor().wrapSelection("redo",null)}}),n("bold",{iconclass:"fa fa-bold",tooltiptext:a.bold.tooltip,action:function(){return this.$editor().wrapSelection("bold",null)},activeState:function(){return this.$editor().queryCommandState("bold")},commandKeyCode:98}),n("justifyLeft",{iconclass:"fa fa-align-left",tooltiptext:a.justifyLeft.tooltip,action:function(){return this.$editor().wrapSelection("justifyLeft",null)},activeState:function(e){if(e&&"#document"===e.nodeName)return!1;var t=!1;if(e)try{t="left"===e.css("text-align")||"left"===e.attr("align")||"right"!==e.css("text-align")&&"center"!==e.css("text-align")&&"justify"!==e.css("text-align")&&!this.$editor().queryCommandState("justifyRight")&&!this.$editor().queryCommandState("justifyCenter")&&!this.$editor().queryCommandState("justifyFull")}catch(e){t=!1}return t=t||this.$editor().queryCommandState("justifyLeft")}}),n("justifyRight",{iconclass:"fa fa-align-right",tooltiptext:a.justifyRight.tooltip,action:function(){return this.$editor().wrapSelection("justifyRight",null)},activeState:function(e){if(e&&"#document"===e.nodeName)return!1;var t=!1;if(e)try{t="right"===e.css("text-align")}catch(e){t=!1}return t=t||this.$editor().queryCommandState("justifyRight")}}),n("justifyFull",{iconclass:"fa fa-align-justify",tooltiptext:a.justifyFull.tooltip,action:function(){return this.$editor().wrapSelection("justifyFull",null)},activeState:function(e){var t=!1;if(e)try{t="justify"===e.css("text-align")}catch(e){t=!1}return t=t||this.$editor().queryCommandState("justifyFull")}}),n("justifyCenter",{iconclass:"fa fa-align-center",tooltiptext:a.justifyCenter.tooltip,action:function(){return this.$editor().wrapSelection("justifyCenter",null)},activeState:function(e){if(e&&"#document"===e.nodeName)return!1;var t=!1;if(e)try{t="center"===e.css("text-align")}catch(e){t=!1}return t=t||this.$editor().queryCommandState("justifyCenter")}}),n("indent",{iconclass:"fa fa-indent",tooltiptext:a.indent.tooltip,action:function(){return this.$editor().wrapSelection("indent",null)},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")},commandKeyCode:"TabKey"}),n("outdent",{iconclass:"fa fa-outdent",tooltiptext:a.outdent.tooltip,action:function(){return this.$editor().wrapSelection("outdent",null)},activeState:function(){return!1},commandKeyCode:"ShiftTabKey"}),n("italics",{iconclass:"fa fa-italic",tooltiptext:a.italic.tooltip,action:function(){return this.$editor().wrapSelection("italic",null)},activeState:function(){return this.$editor().queryCommandState("italic")},commandKeyCode:105}),n("underline",{iconclass:"fa fa-underline",tooltiptext:a.underline.tooltip,action:function(){return this.$editor().wrapSelection("underline",null)},activeState:function(){return this.$editor().queryCommandState("underline")},commandKeyCode:117}),n("strikeThrough",{iconclass:"fa fa-strikethrough",tooltiptext:a.strikeThrough.tooltip,action:function(){return this.$editor().wrapSelection("strikeThrough",null)},activeState:function(){return document.queryCommandState("strikeThrough")}}),n("clear",{iconclass:"fa fa-ban",tooltiptext:a.clear.tooltip,action:function(e,t){this.$editor().wrapSelection("removeFormat",null);var n=angular.element(i.getSelectionElement()),a=i.getAllSelectedElements(),o=function(e,t){e=angular.element(e);var n=t?t:e;return angular.forEach(e.children(),function(e){var t;n="ul"===e.tagName.toLowerCase()||"ol"===e.tagName.toLowerCase()?o(e,n):((t=angular.element("<p></p>")).html(angular.element(e).html()),n.after(t),t)}),e.remove(),n},r=(angular.forEach(a,function(e){"ul"!==e.nodeName.toLowerCase()&&"ol"!==e.nodeName.toLowerCase()||o(e)}),angular.forEach(n.find("ul"),o),angular.forEach(n.find("ol"),o),this.$editor()),l=function(e){(e=angular.element(e))[0]!==r.displayElements.text[0]&&e.removeAttr("class"),angular.forEach(e.children(),l)};angular.forEach(n,l),n[0]&&"li"!==n[0].tagName.toLowerCase()&&"ol"!==n[0].tagName.toLowerCase()&&"ul"!==n[0].tagName.toLowerCase()&&"true"!==n[0].getAttribute("contenteditable")&&this.$editor().wrapSelection("formatBlock","default"),t()}});n("insertImage",{iconclass:"fa fa-picture-o",tooltiptext:a.insertImage.tooltip,action:function(){var e=t.prompt(a.insertImage.dialogPrompt,"http://");if(e&&""!==e&&"http://"!==e&&!d(e))return i.getSelectionElement().tagName&&"a"===i.getSelectionElement().tagName.toLowerCase()&&i.setSelectionAfterElement(i.getSelectionElement()),e='<img src="'+e+'">',this.$editor().wrapSelection("insertHTML",e,!0)},onElementSelect:{element:"img",action:o.imgOnSelectAction}}),n("insertVideo",{iconclass:"fa fa-youtube-play",tooltiptext:a.insertVideo.tooltip,action:function(){var e=t.prompt(a.insertVideo.dialogPrompt,"https://");if(!d(e)&&(e&&""!==e&&"https://"!==e&&(videoId=o.extractYoutubeVideoId(e))))return e="https://www.youtube.com/embed/"+videoId,e='<img class="ta-insert-video" src="https://img.youtube.com/vi/'+videoId+'/hqdefault.jpg" ta-insert-video="'+e+'" contenteditable="false" allowfullscreen="true" frameborder="0" />',i.getSelectionElement().tagName&&"a"===i.getSelectionElement().tagName.toLowerCase()&&i.setSelectionAfterElement(i.getSelectionElement()),this.$editor().wrapSelection("insertHTML",e,!0)},onElementSelect:{element:"img",onlyWithAttrs:["ta-insert-video"],action:o.imgOnSelectAction}}),n("insertLink",{tooltiptext:a.insertLink.tooltip,iconclass:"fa fa-link",action:function(){var e=i.getSelectionElement().tagName&&"a"===i.getSelectionElement().tagName.toLowerCase()?t.prompt(a.insertLink.dialogPrompt,i.getSelectionElement().href):t.prompt(a.insertLink.dialogPrompt,"http://");if(e&&""!==e&&"http://"!==e&&!d(e))return this.$editor().wrapSelection("createLink",e,!0)},activeState:function(e){return!!e&&"A"===e[0].tagName},onElementSelect:{element:"a",action:o.aOnSelectAction}}),n("wordcount",{display:'<div id="toolbarWC" style="display:block; min-width:100px;">Words: <span ng-bind="wordcount"></span></div>',disabled:!0,wordcount:0,activeState:function(){var e=this.$editor().displayElements.text[0].innerHTML||"",t=0;return""!==e.replace(/\s*<[^>]*?>\s*/g,"")&&""!==e.trim()&&(t=e.replace(/<\/?(b|i|em|strong|span|u|strikethrough|a|img|small|sub|sup|label)( [^>*?])?>/gi,"").replace(/(<[^>]*?>\s*<[^>]*?>)/gi," ").replace(/(<[^>]*?>)/gi,"").replace(/\s+/gi," ").match(/\S+/g).length),this.wordcount=t,this.$editor().wordcount=t,!1}}),n("charcount",{display:'<div id="toolbarCC" style="display:block; min-width:120px;">Characters: <span ng-bind="charcount"></span></div>',disabled:!0,charcount:0,activeState:function(){var e=this.$editor().displayElements.text,e=(e[0].innerText||e[0].textContent).replace(/(\r\n|\n|\r)/gm,"").replace(/^\s+/g," ").replace(/\s+$/g," ").length;return this.charcount=e,this.$editor().charcount=e,!1}})}]);var Z=function(){for(var e=3,t=document.createElement("div"),n=t.getElementsByTagName("i");t.innerHTML="\x3c!--[if gt IE "+ ++e+"]><i></i><![endif]--\x3e",n[0];);return 4<e?e:void 0}(),e=/AppleWebKit\/([\d.]+)/i.test(navigator.userAgent),t=(navigator.userAgent.toLowerCase().indexOf("firefox"),{});t.now=t.now||t.mozNow||t.msNow||t.oNow||t.webkitNow||function(){return(new Date).getTime()};var r,ee,te,a,o,l,ne=/^(address|article|aside|audio|blockquote|canvas|center|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video)$/i,V=/^(ul|li|ol)$/i,ae=/^(#text|span|address|article|aside|audio|blockquote|canvas|center|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video|li)$/i;if(String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),8<Z||void 0===Z){for(var i=document.styleSheets,s=0;s<i.length;s++)if((0===i[s].media.length||i[s].media.mediaText.match(/(all|screen)/gi))&&i[s].href&&i[s].href.match(/textangular\.(min\.|)css/gi)){r=i[s];break}r||(t=document.createElement("style"),e&&t.appendChild(document.createTextNode("")),document.getElementsByTagName("head")[0].appendChild(t),r=t.sheet),ee=function(e,t){return a(r,e,t)},a=function(e,t,n){var a,o;return e.cssRules?a=Math.max(e.cssRules.length-1,0):e.rules&&(a=Math.max(e.rules.length-1,0)),e.insertRule?e.insertRule(t+"{"+n+"}",a):e.addRule(t,n,a),r.rules?o=r.rules[a]:r.cssRules&&(o=r.cssRules[a]),o},l=function(e,t){for(var n,a=0;a<t.length;a++)if(t[a].cssText===e.cssText){n=a;break}return n},te=function(e){o(r,e)},o=function(e,t){var n=e.cssRules||e.rules;n&&0!==n.length&&(t=l(t,n),e.removeRule?e.removeRule(t):e.deleteRule(t))}}angular.module("textAngular.factories",[]).factory("taBrowserTag",[function(){return function(e){return e?""===e?void 0===Z?"div":Z<=8?"P":"p":Z<=8?e.toUpperCase():e:Z<=8?"P":"p"}}]).factory("taApplyCustomRenderers",["taCustomRenderers","taDOM",function(t,a){return function(e){var n=angular.element("<div></div>");return n[0].innerHTML=e,angular.forEach(t,function(t){var e=[];t.selector&&""!==t.selector?e=n.find(t.selector):t.customAttribute&&""!==t.customAttribute&&(e=a.getByAttribute(n,t.customAttribute)),angular.forEach(e,function(e){e=angular.element(e),t.selector&&""!==t.selector&&t.customAttribute&&""!==t.customAttribute&&void 0===e.attr(t.customAttribute)||t.renderLogic(e)})}),n[0].innerHTML}}]).factory("taFixChrome",function(){return function(e,t){if(!e||!angular.isString(e)||e.length<=0)return e;for(var n,a,o,r=/style\s?=\s?(["'])(?:(?=(\\?))\2.)*?\1/gi,l=/<span class="Apple-converted-space">([^<]+)<\/span>/gi,i="",s=0;n=l.exec(e);)o=(o=n[1]).replace(/&nbsp;/gi," "),i+=e.substring(s,n.index)+o,s=n.index+n[0].length;if(s&&(e=i+=e.substring(s),i="",s=0),!t){for(;n=r.exec(e);)i+=e.substring(s,n.index-1),a=n[0],(!(n=/font-family: inherit;|line-height: 1.[0-9]{3,12};|color: inherit; line-height: 1.1;|color: rgb\(\d{1,3}, \d{1,3}, \d{1,3}\);|background-color: rgb\(\d{1,3}, \d{1,3}, \d{1,3}\);/gi.exec(a))||8<(a=a.replace(/( |)font-family: inherit;|( |)line-height: 1.[0-9]{3,12};|( |)color: inherit;|( |)color: rgb\(\d{1,3}, \d{1,3}, \d{1,3}\);|( |)background-color: rgb\(\d{1,3}, \d{1,3}, \d{1,3}\);/gi,"")).length)&&(i+=" "+a),s=r.lastIndex;i+=e.substring(s)}return 0<s?i.replace(/<span\s?>(.*?)<\/span>(<br(\/|)>|)/gi,"$1"):e}}).factory("taSanitize",["$sanitize",function(u){for(var f=[{property:"font-weight",values:["bold"],tag:"b"},{property:"font-style",values:["italic"],tag:"i"}],e=[],t=0;t<f.length;t++){for(var n="("+f[t].property+":\\s*(",a=0;a<f[t].values.length;a++)0<a&&(n+="|"),n+=f[t].values[a];n+=");)",e.push(n)}var m="("+e.join("|")+")";function g(e,t){for(var n,a=0,o=0,r=/<[^>]*>/gi;n=r.exec(e);)if(o=n.index,"/"===n[0].substr(1,1)){if(0===a)break;a--}else a++;return t+e.substring(0,o)+angular.element(t)[0].outerHTML.substring(t.length)+e.substring(o)}var c=new RegExp(/<span id="selectionBoundary_\d+_\d+" class="rangySelectionBoundary">[^<>]+?<\/span>/gi),p=new RegExp(/<span class="rangySelectionBoundary" id="selectionBoundary_\d+_\d+">[^<>]+?<\/span>/gi),h=new RegExp(/<span id="selectionBoundary_\d+_\d+" class="rangySelectionBoundary">[^<>]+?<\/span>/gi);return function(e,t,n){if(!n)try{e=function e(t){if(!t||!angular.isString(t)||t.length<=0)return t;for(var n,a,o,r=/<([^>\/]+?)style=("([^"]+)"|'([^']+)')([^>]*)>/gi,l="",i="",s=0;a=r.exec(t);){var d=a[3]||a[4],u=new RegExp(m,"i");if(angular.isString(d)&&u.test(d)){for(var c="",p=new RegExp(m,"ig");o=p.exec(d);)for(n=0;n<f.length;n++)o[2*n+2]&&(c+="<"+f[n].tag+">");u=e(t.substring(s,a.index)),0<l.length?i+=g(u,l):i+=u,d=d.replace(new RegExp(m,"ig"),""),i+="<"+a[1].trim(),0<d.length&&(i+=' style="'+d+'"'),i+=a[5]+">",s=a.index+a[0].length,l=c}}return 0<l.length?i+=g(t.substring(s),l):i+=t.substring(s),i}(e)}catch(e){}if(e=function(e){if(!e||!angular.isString(e)||e.length<=0)return e;for(var t,n=/<([^>\/]+?)align=("([^"]+)"|'([^']+)')([^>]*)>/gi,a="",o=0;t=n.exec(e);){a+=e.substring(o,t.index);var o=t.index+t[0].length,r="<"+t[1]+t[5];/style=("([^"]+)"|'([^']+)')/gi.test(r)?r=r.replace(/style=("([^"]+)"|'([^']+)')/i,'style="$2$3 text-align:'+(t[3]||t[4])+';"'):r+=' style="text-align:'+(t[3]||t[4])+';"',a+=r+=">"}return a+e.substring(o)}(e))try{e=(e=(e=(e=e.replace(c,"")).replace(p,"")).replace(c,"")).replace(h,"")}catch(e){}try{d=u(e),n&&(d=e)}catch(e){d=t||""}for(var a,o=d.match(/(<pre[^>]*>.*?<\/pre[^>]*>)/gi),r=d.replace(/(&#(9|10);)*/gi,""),l=/<pre[^>]*>.*?<\/pre[^>]*>/gi,i=0,s=0,d="";null!==(a=l.exec(r))&&i<o.length;)d+=r.substring(s,a.index)+o[i],s=a.index+a[0].length,i++;return d+r.substring(s)}}]).factory("taToolExecuteAction",["$q","$log",function(r,l){return function(e){void 0!==e&&(this.$editor=function(){return e});var t,n=r.defer(),a=n.promise,o=this.$editor();try{t=this.action(n,o.startAction()),a.finally(function(){o.endAction.call(o)})}catch(e){l.error(e)}!t&&void 0!==t||n.resolve()}}]),angular.module("textAngular.DOM",["textAngular.factories"]).factory("taExecCommand",["taSelection","taBrowserTag","$document",function(_,W,q){function O(e,t){for(var n,a=e.find("li"),o=a.length-1;0<=o;o--)n=angular.element("<"+t+">"+a[o].innerHTML+"</"+t+">"),e.after(n);e.remove(),_.setSelectionToElementEnd(n[0])}function z(e,t,n,a,o){for(var r,l,i,s=e.find("li"),d=0;d<s.length;d++)if(s[d].outerHTML===t[0].outerHTML){0<(i=d)&&(r=s[d-1]),d+1<s.length&&(l=s[d+1]);break}var u="";if(a?u+="<"+o+">"+t[0].innerHTML+"</"+o+">":u=(u=(u+="<"+W(n)+">")+"<li>"+t[0].innerHTML+"</li>")+"</"+W(n)+">",a=angular.element(u),r)if(l){e.parent();var c="",o=e[0].nodeName.toLowerCase();for(c+="<"+o+">",d=0;d<i;d++)c+="<li>"+s[d].innerHTML+"</li>";c+="</"+o+">";var p="";for(p+="<"+o+">",d=i+1;d<s.length;d++)p+="<li>"+s[d].innerHTML+"</li>";p+="</"+o+">",e.after(angular.element(p)),e.after(a),e.after(angular.element(c)),e.remove(),_.setSelectionToElementEnd(a[0])}else t.remove(),e.after(a),_.setSelectionToElementEnd(a[0]);else t.remove(),e.after(angular.element(e[0].outerHTML)),e.after(a),e.remove(),_.setSelectionToElementEnd(a[0])}function r(e){/(<br(|\/)>)$/i.test(e.innerHTML.trim())?_.setSelectionBeforeElement(angular.element(e).find("br")[0]):_.setSelectionToElementEnd(e)}function F(e,t){t=angular.element("<"+t+">"+e[0].innerHTML+"</"+t+">"),e.after(t),e.remove(),r(t.find("li")[0])}function I(e,t,n){for(var a="",o=0;o<e.length;o++)a+="<"+W("li")+">"+e[o].innerHTML+"</"+W("li")+">";n=angular.element("<"+n+">"+a+"</"+n+">"),t.after(n),t.remove(),r(n.find("li")[0])}function P(e,t){for(var n,a=0;a<e.childNodes.length;a++){var o=e.childNodes[a];o.tagName&&o.tagName.match(ne)&&P(o,t)}return null===e.parentNode||"<br>"===t?e:((n=angular.element(t))[0].innerHTML=e.innerHTML,e.parentNode.insertBefore(n[0],e),e.parentNode.removeChild(e),n)}return function(R,K){return R=W(R),function(e,t,n,a){var o,r,l=angular.element("<"+R+">");try{_.getSelection&&(u=_.getSelection()),void 0!==(r=_.getSelectionElement()).tagName&&("div"===r.tagName.toLowerCase()&&/taTextElement.+/.test(r.id)&&u&&u.start&&1===u.start.offset&&1===u.end.offset||"span"===r.tagName.toLowerCase()&&u&&u.start&&1===u.start.offset&&1===u.end.offset?(c=r.innerHTML,/<br>/i.test(c)&&(c=c.replace(/<br>/i,"&#8203;")),/<br\/>/i.test(c)&&(c=c.replace(/<br\/>/i,"&#8203;")),/<span>(<span>)+/i.test(c)&&(c=__.replace(/<span>(<span>)+/i,"<span>")),/<\/span>(<\/span>)+/i.test(c)&&(c=__.replace(/<\/span>(<\/span>)+/i,"</span>")),i="<div>"+(c=/<span><\/span>/i.test(c)?c.replace(/<span><\/span>/i,""):c)+"</div>",r.innerHTML=i,_.setSelectionToElementEnd(r.childNodes[0]),r=_.getSelectionElement()):"p"===r.tagName.toLowerCase()&&u&&u.start&&1===u.start.offset&&1===u.end.offset?(c=r.innerHTML,/<br>/i.test(c)&&(c=c.replace(/<br>/i,"&#8203;"),r.innerHTML=c)):"li"===r.tagName.toLowerCase()&&u&&u.start&&u.start.offset===u.end.offset&&(c=r.innerHTML,/<br>/i.test(c)&&(c=c.replace(/<br>/i,""),r.innerHTML=c)))}catch(e){}if(r){var i=angular.element(r),s=r&&r.tagName&&r.tagName.toLowerCase()||"";if("insertorderedlist"===e.toLowerCase()||"insertunorderedlist"===e.toLowerCase()){var d,u=W("insertorderedlist"===e.toLowerCase()?"ol":"ul"),c=_.getOnlySelectedElements();if(1<c.length&&("ol"===s||"ul"===s)){for(var p,f,m,g=i,h=c,v=u,y=u===s,b=R,x=g.find("li"),E=[],S=0;S<x.length;S++)for(p=0;p<h.length;p++)x[S].isEqualNode(h[p])&&(E[p]=S);0<E[0]&&(f=x[E[0]-1]),E[h.length-1]+1<x.length&&(m=x[E[h.length-1]+1]);var w="";if(y)for(p=0;p<h.length;p++)w+="<"+b+">"+h[p].innerHTML+"</"+b+">",h[p].remove();else{for(w+="<"+W(v)+">",p=0;p<h.length;p++)w+=h[p].outerHTML,h[p].remove();w+="</"+W(v)+">"}if(y=angular.element(w),f)if(m){var T="",v=g[0].nodeName.toLowerCase();for(T+="<"+v+">",S=0;S<E[0];S++)T+="<li>"+x[S].innerHTML+"</li>";T+="</"+v+">";var C="";for(C+="<"+v+">",S=E[h.length-1]+1;S<x.length;S++)C+="<li>"+x[S].innerHTML+"</li>";C+="</"+v+">",g.after(angular.element(C)),g.after(y),g.after(angular.element(T)),g.remove(),_.setSelectionToElementEnd(y[0])}else g.after(y),_.setSelectionToElementEnd(y[0]);else g.after(angular.element(g[0].outerHTML)),g.after(y),g.remove(),_.setSelectionToElementEnd(y[0]);return}if(s===u)return i[0].childNodes.length!==c.length&&1===c.length?(i=angular.element(c[0]),z(i.parent(),i,u,!0,R)):O(i,R);if("li"===s&&i.parent()[0].tagName.toLowerCase()===u&&1===i.parent().children().length)return O(i.parent(),R);if("li"===s&&i.parent()[0].tagName.toLowerCase()!==u&&1===i.parent().children().length)return F(i.parent(),u);if(s.match(ne)&&!i.hasClass("ta-bind"))return c.length&&i[0].childNodes.length!==c.length&&1===c.length?(i=angular.element(c[0]),z(i.parent(),i,u,u===s,R)):"ol"===s||"ul"===s?F(i,u):(d=!1,angular.forEach(i.children(),function(e){e.tagName.match(ne)&&(d=!0)}),I(d?i.children():[angular.element("<div>"+r.innerHTML+"</div>")[0]],i,u));if(s.match(ne)){if(0===(A=_.getOnlySelectedElements()).length)o=angular.element("<"+u+"><li>"+r.innerHTML+"</li></"+u+">"),i.html(""),i.append(o);else{if(1===A.length&&("ol"===A[0].tagName.toLowerCase()||"ul"===A[0].tagName.toLowerCase()))return A[0].tagName.toLowerCase()===u?O(angular.element(A[0]),R):F(angular.element(A[0]),u);for(var N,L="",$=[],k=0;k<A.length;k++)3!==A[k].nodeType&&(N=angular.element(A[k]),"li"!==A[k].tagName.toLowerCase()&&("ol"===A[k].tagName.toLowerCase()||"ul"===A[k].tagName.toLowerCase()?L+=N[0].innerHTML:"span"!==A[k].tagName.toLowerCase()||"ol"!==A[k].childNodes[0].tagName.toLowerCase()&&"ul"!==A[k].childNodes[0].tagName.toLowerCase()?L+="<"+W("li")+">"+N[0].innerHTML+"</"+W("li")+">":L+=N[0].childNodes[0].innerHTML,$.unshift(N)));o=angular.element("<"+u+">"+L+"</"+u+">"),$.pop().replaceWith(o),angular.forEach($,function(e){e.remove()})}return void _.setSelectionToElementEnd(o[0])}}else{if("formatblock"===e.toLowerCase()){for("default"===(f=n.toLowerCase().replace(/[<>]/gi,"")).trim()&&(n="<"+(f=R)+">"),o="li"===s?i.parent():i;!o[0].tagName||!o[0].tagName.match(ne)&&!o.parent().attr("contenteditable");)s=((o=o.parent())[0].tagName||"").toLowerCase();if(s===f){var A=o.children(),M=!1;for(k=0;k<A.length;k++)M=M||A[k].tagName.match(ne);o=M?(o.after(A),m=o.next(),o.remove(),m):(l.append(o[0].childNodes),o.after(l),o.remove(),l)}else if(o.parent()[0].tagName.toLowerCase()!==f||o.parent().hasClass("ta-bind"))if(s.match(V))o.wrap(n);else{for(0===(A=_.getOnlySelectedElements()).length&&(A=[o[0]]),k=0;k<A.length;k++)if(3===A[k].nodeType||!A[k].tagName.match(ne))for(;3===A[k].nodeType||!A[k].tagName||!A[k].tagName.match(ne);)A[k]=A[k].parentNode;if(1<(A=A.filter(function(e,t,n){return n.indexOf(e)===t})).length&&(A=A.filter(function(e,t,n){return!("div"===e.nodeName.toLowerCase()&&/^taTextElement/.test(e.id))})),angular.element(A[0]).hasClass("ta-bind"))(o=angular.element(n))[0].innerHTML=A[0].innerHTML,A[0].innerHTML=o[0].outerHTML;else if("blockquote"===f){for(L="",k=0;k<A.length;k++)L+=A[k].outerHTML;for((o=angular.element(n))[0].innerHTML=L,A[0].parentNode.insertBefore(o[0],A[0]),k=A.length-1;0<=k;k--)A[k].parentNode&&A[k].parentNode.removeChild(A[k])}else if("pre"===f&&_.getStateShiftKey()){for(L="",k=0;k<A.length;k++)L+=A[k].outerHTML;for((o=angular.element(n))[0].innerHTML=L,A[0].parentNode.insertBefore(o[0],A[0]),k=A.length-1;0<=k;k--)A[k].parentNode&&A[k].parentNode.removeChild(A[k])}else for(k=0;k<A.length;k++){var H=P(A[k],n);A[k]===o[0]&&(o=angular.element(H))}}else{var D=o.parent(),B=D.contents();for(k=0;k<B.length;k++)D.parent().hasClass("ta-bind")&&3===B[k].nodeType&&((l=angular.element("<"+R+">"))[0].innerHTML=B[k].outerHTML,B[k]=l[0]),D.parent()[0].insertBefore(B[k],D[0]);D.remove()}return _.setSelectionToElementEnd(o[0]),void o[0].focus()}if("createlink"===e.toLowerCase()){if("a"===s)return void(_.getSelectionElement().href=n);v='<a href="'+n+'" target="'+(a.a.target||"")+'">';return void(_.getSelection().collapsed?_.insertHtml(v+n+"</a>",K):Q.getSelection().getRangeAt(0).canSurroundContents()&&(g=angular.element(v+"</a>")[0],Q.getSelection().getRangeAt(0).surroundContents(g)))}if("inserthtml"===e.toLowerCase())return void _.insertHtml(n,K)}try{q[0].execCommand(e,t,n)}catch(e){}}}}}]).service("taSelection",["$document","taDOM","$log",function(e,v,t){function n(e,t){return e.tagName&&e.tagName.match(/^br$/i)&&0===t&&!e.previousSibling?{element:e.parentNode,offset:0}:{element:e,offset:t}}var a,y=e[0],b={getSelection:function(){try{t=Q.getSelection().getRangeAt(0)}catch(e){return}var e=t.commonAncestorContainer,t={start:n(t.startContainer,t.startOffset),end:n(t.endContainer,t.endOffset),collapsed:t.collapsed};return"div"===(e=3!==e.nodeType||"div"===e.parentNode.nodeName.toLowerCase()&&/^taTextElement/.test(e.parentNode.id)?e:e.parentNode).nodeName.toLowerCase()&&/^taTextElement/.test(e.id)?(t.start.element=e.childNodes[t.start.offset],t.end.element=e.childNodes[t.end.offset],t.container=e):e.parentNode===t.start.element||e.parentNode===t.end.element?t.container=e.parentNode:t.container=e,t},updateLeftArrowKey:function(e){var t=Q.getSelection().getRangeAt(0);if(t&&t.collapsed){var n=b.getFlattenedDom(t);if(!n.findIndex)return;var a,o,r=t.startContainer,l=n.findIndex(function(e,t){return e.node===r||-1!==e.parents.indexOf(r)});if(n.forEach(function(e,t){e.parents.forEach(function(e,t){})}),(a=l+1<n.length?n[l+1].node:a)&&a.textContent&&/^\ufeff([^\ufeff]*)$/.exec(a.textContent))return;if(0<l&&(o=n[l-1].node),0===t.startOffset&&o&&/^\ufeff([^\ufeff]*)$/.exec(o.textContent))return void b.setSelectionToElementEnd(o)}},updateRightArrowKey:function(e){},getFlattenedDom:function(e){var t=e.commonAncestorContainer.parentNode;if(!t)return e.commonAncestorContainer.childNodes;var o=Array.prototype.slice.call(t.childNodes),e=o.indexOf(e.startContainer);return e+1<o.length&&0<e||t.parentNode&&(t=t.parentNode),o=[],function n(a){a.node.childNodes.length?Array.prototype.slice.call(a.node.childNodes).forEach(function(e){var t=a.parents.slice();t.slice(-1)[0]!==a.node&&t.push(a.node),n({parents:t,node:e})}):o.push({parents:a.parents,node:a.node})}({parents:[t],node:t}),o},getOnlySelectedElements:function(){var e=Q.getSelection().getRangeAt(0),t=3===(t=e.commonAncestorContainer).nodeType?t.parentNode:t;return e.getNodes([1],function(e){return e.parentNode===t})},getAllSelectedElements:function(){var e=Q.getSelection().getRangeAt(0),t=3===(t=e.commonAncestorContainer).nodeType?t.parentNode:t,n=e.getNodes([1],function(e){return e.parentNode===t});if(t.innerHTML.replace(/<span id=.selectionBoundary[^>]+>\ufeff?<\/span>/gi,"")===e.toHtml()&&("div"!==t.nodeName.toLowerCase()||!/^taTextElement/.test(t.id))){for(var a=[],o=n.length;o--;a.unshift(n[o]));(n=a).push(t)}return n},getSelectionElement:function(){if(b.getSelection())return b.getSelection().container},setSelection:function(e,t,n,a){var o=Q.createRange();o.setStart(e,n),o.setEnd(t,a),Q.getSelection().setSingleRange(o)},setSelectionBeforeElement:function(e){var t=Q.createRange();t.selectNode(e),t.collapse(!0),Q.getSelection().setSingleRange(t)},setSelectionAfterElement:function(e){var t=Q.createRange();t.selectNode(e),t.collapse(!1),Q.getSelection().setSingleRange(t)},setSelectionToElementStart:function(e){var t=Q.createRange();t.selectNodeContents(e),t.collapse(!0),Q.getSelection().setSingleRange(t)},setSelectionToElementEnd:function(e){var t=Q.createRange();t.selectNodeContents(e),t.collapse(!1),e.childNodes&&e.childNodes[e.childNodes.length-1]&&"br"===e.childNodes[e.childNodes.length-1].nodeName&&(t.startOffset=t.endOffset=t.startOffset-1),Q.getSelection().setSingleRange(t)},setStateShiftKey:function(e){a=e},getStateShiftKey:function(){return a},insertHtml:function(e,t){var n,a,o,r,l,i=angular.element("<div>"+e+"</div>"),s=Q.getSelection().getRangeAt(0),d=y.createDocumentFragment(),u=i[0].childNodes,c=!0;if(0<u.length){for(a=[],n=0;n<u.length;n++){var p=u[n];"p"===p.nodeName.toLowerCase()&&""===p.innerHTML.trim()||(c=c&&!ne.test(p.nodeName),a.push(p))}for(var f=0;f<a.length;f++)r=d.appendChild(a[f]);!c&&s.collapsed&&/^(|<br(|\/)>)$/i.test(s.startContainer.innerHTML)&&s.selectNode(s.startContainer)}else c=!0,r=d=y.createTextNode(e);if(c)s.deleteContents();else if(s.collapsed&&s.startContainer!==t)if(s.startContainer.innerHTML&&s.startContainer.innerHTML.match(/^<[^>]*>$/i))m=s.startContainer,1===s.startOffset?(s.setStartAfter(m),s.setEndAfter(m)):(s.setStartBefore(m),s.setEndBefore(m));else{if(3===s.startContainer.nodeType&&s.startContainer.parentNode!==t)for(h=(m=s.startContainer.parentNode).cloneNode(),v.splitNodes(m.childNodes,m,h,s.startContainer,s.startOffset);!ae.test(m.nodeName);){angular.element(m).after(h);var m,g=h,h=(m=m.parentNode).cloneNode();v.splitNodes(m.childNodes,m,h,g)}else h=(m=s.startContainer).cloneNode(),v.splitNodes(m.childNodes,m,h,void 0,void 0,s.startOffset);if(angular.element(m).after(h),s.setStartAfter(m),s.setEndAfter(m),/^(|<br(|\/)>)$/i.test(m.innerHTML.trim())&&(s.setStartBefore(m),s.setEndBefore(m),angular.element(m).remove()),/^(|<br(|\/)>)$/i.test(h.innerHTML.trim())&&angular.element(h).remove(),"li"===m.nodeName.toLowerCase()){for(l=y.createDocumentFragment(),o=0;o<d.childNodes.length;o++)i=angular.element("<li>"),v.transferChildNodes(d.childNodes[o],i[0]),v.transferNodeAttributes(d.childNodes[o],i[0]),l.appendChild(i[0]);d=l,r=r&&(r=d.childNodes[d.childNodes.length-1]).childNodes[r.childNodes.length-1]}}else s.deleteContents();s.insertNode(d),r&&b.setSelectionToElementEnd(r)}};return b}]).service("taDOM",function(){var d={getByAttribute:function(e,t){var n=[],a=e.children();return a.length&&angular.forEach(a,function(e){n=n.concat(d.getByAttribute(angular.element(e),t))}),void 0!==e.attr(t)&&n.push(e),n},transferChildNodes:function(e,t){for(t.innerHTML="";0<e.childNodes.length;)t.appendChild(e.childNodes[0]);return t},splitNodes:function(e,t,n,a,o,r){if(!a&&isNaN(r))throw new Error("taDOM.splitNodes requires a splitNode or splitIndex");for(var l=document.createDocumentFragment(),i=document.createDocumentFragment(),s=0;0<e.length&&(isNaN(r)||r!==s)&&e[0]!==a;)l.appendChild(e[0]),s++;for(!isNaN(o)&&0<=o&&e[0]&&(l.appendChild(document.createTextNode(e[0].nodeValue.substring(0,o))),e[0].nodeValue=e[0].nodeValue.substring(o));0<e.length;)i.appendChild(e[0]);d.transferChildNodes(l,t),d.transferChildNodes(i,n)},transferNodeAttributes:function(e,t){for(var n=0;n<e.attributes.length;n++)t.setAttribute(e.attributes[n].name,e.attributes[n].value);return t}};return d}),angular.module("textAngular.validators",[]).directive("taMaxText",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){var o=parseInt(e.$eval(n.taMaxText));if(isNaN(o))throw"Max text must be an integer";n.$observe("taMaxText",function(e){if(o=parseInt(e),isNaN(o))throw"Max text must be an integer";a.$dirty&&a.$validate()}),a.$validators.taMaxText=function(e){var t=angular.element("<div/>");return t.html(e),t.text().length<=o}}}}).directive("taMinText",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){var o=parseInt(e.$eval(n.taMinText));if(isNaN(o))throw"Min text must be an integer";n.$observe("taMinText",function(e){if(o=parseInt(e),isNaN(o))throw"Min text must be an integer";a.$dirty&&a.$validate()}),a.$validators.taMinText=function(e){var t=angular.element("<div/>");return t.html(e),!t.text().length||t.text().length>=o}}}}).directive("taMaxHtml",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){var o=parseInt(e.$eval(n.taMaxHtml));if(isNaN(o))throw"Max html must be an integer";n.$observe("taMaxHtml",function(e){if(o=parseInt(e),isNaN(o))throw"Max html must be an integer";a.$dirty&&a.$validate()}),a.$validators.taMaxHtml=function(e){return(e||"").length<=o}}}}),angular.module("textAngular.taBind",["textAngular.factories","textAngular.DOM"]).service("_taBlankTest",[function(){return function(e){if(!e)return!0;var t,n;t=e,(n=document.createElement("DIV")).innerHTML=t,(t=n.textContent||n.innerText||"").replace("​",""),t=t.trim();return""===t&&!/<img[^>]+>/.test(e)}}]).directive("taButton",[function(){return{link:function(e,t,n){t.attr("unselectable","on"),t.on("mousedown",function(e,t){return t&&angular.extend(e,t),e.preventDefault(),!1})}}}]).directive("taBind",["taSanitize","$timeout","$document","taFixChrome","taBrowserTag","taSelection","taSelectableElements","taApplyCustomRenderers","taOptions","_taBlankTest","$parse","taDOM","textAngularManager",function(z,F,I,P,e,V,U,j,G,X,Y,t,J){return{priority:2,require:["ngModel","?ngModelOptions"],link:function(v,y,s,e){var r,b,d,x=e[0],l=e[1]||{},a=void 0!==y.attr("contenteditable")&&y.attr("contenteditable"),t=a||"textarea"===y[0].tagName.toLowerCase()||"input"===y[0].tagName.toLowerCase(),u=!1,n=!1,o=!1,E=G.disableSanitizer,i=s.taKeepStyles||G.keepStyles,K=/^(9|19|20|27|33|34|35|36|37|38|39|40|45|112|113|114|115|116|117|118|119|120|121|122|123|144|145)$/i,_=/^(8|13|32|46|59|61|107|109|173|186|187|188|189|190|191|192|219|220|221|222)$/i,W=[{specialKey:"UndoKey",forbiddenModifiers:12,mustHaveModifiers:[3],keyCode:90},{specialKey:"RedoKey",forbiddenModifiers:4,mustHaveModifiers:[3,8],keyCode:90},{specialKey:"RedoKey",forbiddenModifiers:12,mustHaveModifiers:[3],keyCode:89},{specialKey:"TabKey",forbiddenModifiers:15,mustHaveModifiers:[],keyCode:9},{specialKey:"ShiftTabKey",forbiddenModifiers:7,mustHaveModifiers:[8],keyCode:9}];void 0===s.taDefaultWrap&&(s.taDefaultWrap="p"),""===s.taDefaultWrap?d="":(d=void 0===Z||11<=Z?"br"===s.taDefaultWrap.toLowerCase()?"<BR><BR>":"<"+s.taDefaultWrap+"><br></"+s.taDefaultWrap+">":Z<=8?"<"+s.taDefaultWrap.toUpperCase()+"></"+s.taDefaultWrap.toUpperCase()+">":"<"+s.taDefaultWrap+"></"+s.taDefaultWrap+">",void 0===Z||11<=Z?"br"!==s.taDefaultWrap.toLowerCase()&&(s.taDefaultWrap,s.taDefaultWrap):Z<=8?(s.taDefaultWrap.toUpperCase(),s.taDefaultWrap.toUpperCase()):(s.taDefaultWrap,s.taDefaultWrap)),l.$options||(l.$options={});function c(e){if(X(e))return e;var t=angular.element("<div>"+e+"</div>");if(0===t.children().length)e="<"+s.taDefaultWrap+">"+e+"</"+s.taDefaultWrap+">";else{for(var n=t[0].childNodes,a=!1,o=0;o<n.length&&!(a=n[o].nodeName.toLowerCase().match(ne));o++);if(a)for(e="",o=0;o<n.length;o++){var r,l=n[o],i=l.nodeName.toLowerCase();"#comment"===i?e+="\x3c!--"+l.nodeValue+"--\x3e":"#text"===i?(r=l.textContent).trim()?e+="<"+s.taDefaultWrap+">"+r+"</"+s.taDefaultWrap+">":e+=r:i.match(ne)?e+=l.outerHTML:""!==(r=l.outerHTML||l.nodeValue).trim()?e+="<"+s.taDefaultWrap+">"+r+"</"+s.taDefaultWrap+">":e+=r}else e="<"+s.taDefaultWrap+">"+e+"</"+s.taDefaultWrap+">"}return e}function S(){if(a)return y[0].innerHTML;if(t)return y.val();throw"textAngular Error: attempting to update non-editable taBind"}function p(e){return v.$emit("ta-element-select",this),e.preventDefault(),!1}s.taPaste&&(b=Y(s.taPaste)),y.addClass("ta-bind"),v["$undoManager"+(s.id||"")]=x.$undoManager={_stack:[],_index:0,_max:1e3,push:function(e){return null==e||void 0!==this.current()&&null!==this.current()&&e===this.current()||(this._index<this._stack.length-1&&(this._stack=this._stack.slice(0,this._index+1)),this._stack.push(e),h&&F.cancel(h),this._stack.length>this._max&&this._stack.shift(),this._index=this._stack.length-1),e},undo:function(){return this.setToIndex(this._index-1)},redo:function(){return this.setToIndex(this._index+1)},setToIndex:function(e){if(!(e<0||e>this._stack.length-1))return this._index=e,this.current()},current:function(){return this._stack[this._index]}};function f(e,t,n){o=n||!1,null==t&&(t=a),null==e&&(e=S()),X(e)?(""!==x.$viewValue&&x.$setViewValue(""),t&&""!==x.$undoManager.current()&&x.$undoManager.push("")):(T(),x.$viewValue!==e&&(x.$setViewValue(e),t&&x.$undoManager.push(e))),x.$render()}function m(e){y[0].innerHTML=e}function g(e){return x.$oldViewValue=z(P(e,i),x.$oldViewValue,E)}var h,w,T=v["reApplyOnSelectorHandlers"+(s.id||"")]=function(){u||angular.forEach(U,function(e){y.find(e).off("click",p).on("click",p)})},q=v["$undoTaBind"+(s.id||"")]=function(){var e;!u&&a&&null!=(e=x.$undoManager.undo())&&(m(e),f(e,!1),w&&F.cancel(w),w=F(function(){y[0].focus(),V.setSelectionToElementEnd(y[0])},1))},O=v["$redoTaBind"+(s.id||"")]=function(){var e;!u&&a&&null!=(e=x.$undoManager.redo())&&(m(e),f(e,!1),w&&F.cancel(w),w=F(function(){y[0].focus(),V.setSelectionToElementEnd(y[0])},1))};v["updateTaBind"+(s.id||"")]=function(){u||f(void 0,void 0,!0)};if(y.attr("required")&&(x.$validators.required=function(e,t){return!X(e||t)}),x.$parsers.push(g),x.$parsers.unshift(c),x.$formatters.push(g),x.$formatters.unshift(c),x.$formatters.unshift(function(e){return x.$undoManager.push(e||"")}),t)if(v.events={},a){function C(e){var t=void 0!==e&&e.match(/content=["']*OneNote.File/i);if(e&&e.trim().length){if(e.match(/class=["']*Mso(Normal|List)/i)||e.match(/content=["']*Word.Document/i)||e.match(/content=["']*OneNote.File/i)){var n=e.match(/<!--StartFragment-->([\s\S]*?)<!--EndFragment-->/i);n=(n=n?n[1]:e).replace(/<o:p>[\s\S]*?<\/o:p>/gi,"").replace(/class=(["']|)MsoNormal(["']|)/gi,"");function a(e){l.isUl=e,l.element=angular.element(e?"<ul>":"<ol>"),l.lastIndent=[],l.lastIndent.peek=function(){var e=this.length;if(0<e)return this[e-1]},l.lastLevelMatch=null}for(var o=angular.element("<div>"+n+"</div>"),r=angular.element("<div></div>"),l={element:null,lastIndent:[],lastLi:null,isUl:!1},i=(l.lastIndent.peek=function(){var e=this.length;if(0<e)return this[e-1]},0);i<=o[0].childNodes.length;i++)if(o[0].childNodes[i]&&"#text"!==o[0].childNodes[i].nodeName){var s=o[0].childNodes[i].tagName.toLowerCase();if("p"===s||"ul"===s||"h1"===s||"h2"===s||"h3"===s||"h4"===s||"h5"===s||"h6"===s||"table"===s){var s=angular.element(o[0].childNodes[i]),d=(s.attr("class")||"").match(/MsoList(Bullet|Number|Paragraph)(CxSp(First|Middle|Last)|)/i);if(d){if(!(s[0].childNodes.length<2||s[0].childNodes[1].childNodes.length<1)){var u="bullet"===d[1].toLowerCase()||"number"!==d[1].toLowerCase()&&!(/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(s[0].childNodes[1].innerHTML)||/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(s[0].childNodes[1].childNodes[0].innerHTML)),c=(s.attr("style")||"").match(/margin-left:([\-\.0-9]*)/i),p=parseFloat(c?c[1]:0),c=(s.attr("style")||"").match(/mso-list:l([0-9]+) level([0-9]+) lfo[0-9+]($|;)/i);if(c&&c[2]&&(p=parseInt(c[2])),c&&(!l.lastLevelMatch||c[1]!==l.lastLevelMatch[1])||!d[3]||"first"===d[3].toLowerCase()||null===l.lastIndent.peek()||l.isUl!==u&&l.lastIndent.peek()===p)a(u),r.append(l.element);else if(null!=l.lastIndent.peek()&&l.lastIndent.peek()<p)l.element=angular.element(u?"<ul>":"<ol>"),l.lastLi.append(l.element);else if(null!=l.lastIndent.peek()&&l.lastIndent.peek()>p){for(;null!=l.lastIndent.peek()&&l.lastIndent.peek()>p;)if("li"===l.element.parent()[0].tagName.toLowerCase())l.element=l.element.parent();else{if(!/[uo]l/i.test(l.element.parent()[0].tagName.toLowerCase()))break;l.element=l.element.parent(),l.lastIndent.pop()}l.isUl="ul"===l.element[0].tagName.toLowerCase(),u!==l.isUl&&(a(u),r.append(l.element))}l.lastLevelMatch=c,p!==l.lastIndent.peek()&&l.lastIndent.push(p),l.lastLi=angular.element("<li>"),l.element.append(l.lastLi),l.lastLi.html(s.html().replace(/<!(--|)\[if !supportLists\](--|)>[\s\S]*?<!(--|)\[endif\](--|)>/gi,"")),s.remove()}}else a(!1),r.append(s)}}function f(e){for(var t=(e=angular.element(e))[0].childNodes.length-1;0<=t;t--)e.after(e[0].childNodes[t]);e.remove()}angular.forEach(r.find("span"),function(e){e.removeAttribute("lang"),e.attributes.length<=0&&f(e)}),angular.forEach(r.find("font"),f),e=r.html(),e=(e=t?r.html()||o.html():e).replace(/\n/g," ")}else{if((e=e.replace(/<(|\/)meta[^>]*?>/gi,"")).match(/<[^>]*?(ta-bind)[^>]*?>/)){if(e.match(/<[^>]*?(text-angular)[^>]*?>/)){n=angular.element("<div>"+e+"</div>");n.find("textarea").remove();for(var m=0;m<binds.length;m++){for(var g=binds[m][0].parentNode.parentNode,h=0;h<binds[m][0].childNodes.length;h++)g.parentNode.insertBefore(binds[m][0].childNodes[h],g);g.parentNode.removeChild(g)}e=n.html().replace('<br class="Apple-interchange-newline">',"")}}else!e.match(/^<span/)||e.match(/<span class=(\"Apple-converted-space\"|\'Apple-converted-space\')>.<\/span>/gi)||(e=e.replace(/<(|\/)span[^>]*?>/gi,""));e=e.replace(/<br class="Apple-interchange-newline"[^>]*?>/gi,"").replace(/<span class="Apple-converted-space">( |&nbsp;)<\/span>/gi,"&nbsp;")}e=(e=/<li(\s.*)?>/i.test(e)&&!1===/(<ul(\s.*)?>|<ol(\s.*)?>).*<li(\s.*)?>/i.test(e)?e.replace(/<li(\s.*)?>.*<\/li(\s.*)?>/i,"<ul>$&</ul>"):e).replace(/^[ |\u00A0]+/gm,function(e){for(var t="",n=0;n<e.length;n++)t+="&nbsp;";return t}).replace(/\n|\r\n|\r/g,"<br />").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;"),e=(e=b?b(v,{$html:e})||e:e).replace(/<span style=("|')([^<]*?)vertical-align\s*:\s*super;?([^>]*?)("|')>([^<]+?)<\/span>/g,"<sup style='$2$3'>$5</sup>"),e=z(e,"",E),V.insertHtml(e,y[0]),F(function(){x.$setViewValue(S()),k=!1,y.removeClass("processing-paste")},0)}else k=!1,y.removeClass("processing-paste")}var N,L,$,k=!1;if(y.on("paste",v.events.paste=function(e,t){if(t&&angular.extend(e,t),u||k)return e.stopPropagation(),e.preventDefault(),!1;k=!0,y.addClass("processing-paste");var n,a=(e.originalEvent||e).clipboardData;if(!a&&window.clipboardData&&window.clipboardData.getData)return n=window.clipboardData.getData("Text"),C(n),e.stopPropagation(),e.preventDefault(),!1;if(a&&a.getData&&0<a.types.length){for(var o="",r=0;r<a.types.length;r++)o+=" "+a.types[r];return/text\/html/i.test(o)?n=a.getData("text/html"):/text\/plain/i.test(o)&&(n=a.getData("text/plain")),C(n),e.stopPropagation(),e.preventDefault(),!1}var l=Q.saveSelection(),i=angular.element('<div class="ta-hidden-input" contenteditable="true"></div>');I.find("body").append(i),i[0].focus(),F(function(){Q.restoreSelection(l),C(i[0].innerHTML),y[0].focus(),i.remove()},0)}),y.on("cut",v.events.cut=function(e){u?e.preventDefault():F(function(){x.$setViewValue(S())},0)}),y.on("keydown",v.events.keydown=function(t,e){var n,a,o,r,l,i;e&&angular.extend(t,e),16===t.keyCode?V.setStateShiftKey(!0):V.setStateShiftKey(!1),t.specialKey=(n=t,W.forEach(function(e){var t;e.keyCode===n.keyCode&&(t=(n.metaKey?2:0)+(n.ctrlKey?1:0)+(n.shiftKey?8:0)+(n.altKey?4:0),e.forbiddenModifiers&t||e.mustHaveModifiers.every(function(e){return t&e})&&(a=e.specialKey))}),a),G.keyMappings.forEach(function(e){t.specialKey===e.commandKeyCode&&(t.specialKey=void 0),e.testForKey(t)&&(o=e.commandKeyCode),"UndoKey"!==e.commandKeyCode&&"RedoKey"!==e.commandKeyCode||e.enablePropagation||t.preventDefault()}),void 0!==o&&(t.specialKey=o),void 0===t.specialKey||"UndoKey"===t.specialKey&&"RedoKey"===t.specialKey||(t.preventDefault(),J.sendKeyCommand(v,t)),u||("UndoKey"===t.specialKey&&(q(),t.preventDefault()),"RedoKey"===t.specialKey&&(O(),t.preventDefault()),13!==t.keyCode||t.shiftKey||t.ctrlKey||t.metaKey||t.altKey||(e=V.getSelectionElement()).nodeName.match(ae)&&(r=angular.element(d),function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1}(["blockquote","ul","ol"],e.parentNode.tagName.toLowerCase())&&(/^<br(|\/)>$/i.test(e.innerHTML.trim())&&!e.nextSibling&&((i=(l=angular.element(e)).parent()).after(r),l.remove(),0===i.children().length&&i.remove(),V.setSelectionToElementStart(r[0]),t.preventDefault()),/^<[^>]+><br(|\/)><\/[^>]+>$/i.test(e.innerHTML.trim())&&((l=angular.element(e)).after(r),l.remove(),V.setSelectionToElementStart(r[0]),t.preventDefault()))))}),y.on("keyup",v.events.keyup=function(e,t){if(t&&angular.extend(e,t),V.setStateShiftKey(!1),9===e.keyCode)V.getSelection().start.element===y[0]&&y.children().length&&V.setSelectionToElementStart(y.children()[0]);else if(37!==e.keyCode||e.shiftKey||V.updateLeftArrowKey(y),39!==e.keyCode||e.shiftKey||V.updateRightArrowKey(y),h&&F.cancel(h),!(u||K.test(e.keyCode)||13===e.keyCode&&(e.ctrlKey||e.metaKey||e.altKey))){if(""!==d&&"<BR><BR>"!==d&&13===e.keyCode&&!e.ctrlKey&&!e.metaKey&&!e.altKey){for(var n=V.getSelectionElement();!n.nodeName.match(ae)&&n!==y[0];)n=n.parentNode;e.shiftKey?(t=n.tagName.toLowerCase())!==s.taDefaultWrap&&"li"!==t&&"pre"!==t&&"div"!==t||/.+<br><br>/.test(n.innerHTML.trim())||(t=n.previousSibling)&&(t.innerHTML=t.innerHTML+"<br><br>",angular.element(n).remove(),V.setSelectionToElementEnd(t)):n.tagName.toLowerCase()===s.taDefaultWrap||"li"===n.nodeName.toLowerCase()||""!==n.innerHTML.trim()&&"<br>"!==n.innerHTML.trim()||(t=angular.element(d),angular.element(n).replaceWith(t),V.setSelectionToElementStart(t[0]))}var a=S(),o=(""===d||""!==a.trim()&&"<br>"!==a.trim()?"<"!==a.substring(0,1)&&s.taDefaultWrap:(m(d),V.setSelectionToElementStart(y.children()[0])),r!==e.keyCode&&_.test(e.keyCode));N&&F.cancel(N),N=F(function(){f(a,o,!0)},l.$options.debounce||400),o||(h=F(function(){x.$undoManager.push(a)},250)),r=e.keyCode}}),y.on("input",function(){S()!==x.$viewValue&&(L&&F.cancel(L),L=F(function(){var e=Q.saveSelection(),t=S();t!==x.$viewValue&&f(t,!0),0!==x.$viewValue.length&&Q.restoreSelection(e)},1e3))}),y.on("blur",v.events.blur=function(){n=!1,u?(o=!0,x.$render()):f(void 0,void 0,!0)}),s.placeholder&&(8<Z||void 0===Z)){if(!s.id)throw"textAngular Error: An unique ID is required for placeholders to work";$=ee("#"+s.id+".placeholder-text:before",'content: "'+s.placeholder+'"'),v.$on("$destroy",function(){te($)})}y.on("focus",v.events.focus=function(){n=!0,y.removeClass("placeholder-text"),T()}),y.on("mouseup",v.events.mouseup=function(){var e=V.getSelection();e&&e.start.element===y[0]&&y.children().length&&V.setSelectionToElementStart(y.children()[0])}),y.on("mousedown",v.events.mousedown=function(e,t){t&&angular.extend(e,t),e.stopPropagation()})}else{y.on("change blur",v.events.change=v.events.blur=function(){u||x.$setViewValue(S())}),y.on("keydown",v.events.keydown=function(e,t){var n,a,o,r;t&&angular.extend(e,t),9===e.keyCode&&(t=this.selectionStart,n=this.selectionEnd,a=y.val(),e.shiftKey?(o=a.lastIndexOf("\n",t),-1!==(r=a.lastIndexOf("\t",t))&&o<=r&&(y.val(a.substring(0,r)+a.substring(r+1)),this.selectionStart=this.selectionEnd=t-1)):(y.val(a.substring(0,t)+"\t"+a.substring(n)),this.selectionStart=this.selectionEnd=t+1),e.preventDefault())});function A(e,t){for(var n="",a=0;a<t;a++)n+=e;return n}function M(e,t,n){for(var a=0;a<e.length;a++)t.call(n,a,e[a])}function H(e,a){var o="",t=e.childNodes;return o+=A("\t",++a-1)+e.outerHTML.substring(0,4),M(t,function(e,t){var n=t.nodeName.toLowerCase();"#comment"===n?o+="\x3c!--"+t.nodeValue+"--\x3e":"#text"===n?o+=t.textContent:t.outerHTML&&(o+="ul"===n||"ol"===n?"\n"+H(t,a):"\n"+A("\t",a)+t.outerHTML)}),o+="\n"+A("\t",a-1)+e.outerHTML.substring(e.outerHTML.lastIndexOf("<"))}x.$formatters.unshift(function(a){var e=angular.element("<div>"+a+"</div>")[0].childNodes;return 0<e.length&&(a="",M(e,function(e,t){var n=t.nodeName.toLowerCase();"#comment"===n?a+="\x3c!--"+t.nodeValue+"--\x3e":"#text"===n?a+=t.textContent:t.outerHTML&&(0<a.length&&(a+="\n"),a+="ul"===n||"ol"===n?""+H(t,0):""+t.outerHTML)})),a})}function D(e,t){t&&angular.extend(e,t),oe||u||(oe=!0,t=(e.originalEvent||e).dataTransfer,v.$emit("ta-drop-event",this,e,t),F(function(){f(void 0,void 0,!(oe=!1))},100))}var B,R=!1;x.$render=function(){var e;R||(R=!0,e=x.$viewValue||"",o||(a&&n&&(y.removeClass("placeholder-text"),B&&F.cancel(B),B=F(function(){n||(y[0].focus(),V.setSelectionToElementEnd(y.children()[y.children().length-1])),B=void 0},1)),a?(s.placeholder,m(""===e?d:e),u?y.off("drop",D):(T(),y.on("drop",D))):"textarea"!==y[0].tagName.toLowerCase()&&"input"!==y[0].tagName.toLowerCase()?m(j(e)):y.val(e)),a&&s.placeholder&&(""!==e||n?y.removeClass("placeholder-text"):y.addClass("placeholder-text")),R=o=!1)},s.taReadonly&&((u=v.$eval(s.taReadonly))?(y.addClass("ta-readonly"),"textarea"!==y[0].tagName.toLowerCase()&&"input"!==y[0].tagName.toLowerCase()||y.attr("disabled","disabled"),void 0!==y.attr("contenteditable")&&y.attr("contenteditable")&&y.removeAttr("contenteditable")):(y.removeClass("ta-readonly"),"textarea"===y[0].tagName.toLowerCase()||"input"===y[0].tagName.toLowerCase()?y.removeAttr("disabled"):a&&y.attr("contenteditable","true")),v.$watch(s.taReadonly,function(e,t){t!==e&&(e?(y.addClass("ta-readonly"),"textarea"!==y[0].tagName.toLowerCase()&&"input"!==y[0].tagName.toLowerCase()||y.attr("disabled","disabled"),void 0!==y.attr("contenteditable")&&y.attr("contenteditable")&&y.removeAttr("contenteditable"),angular.forEach(U,function(e){y.find(e).on("click",p)}),y.off("drop",D)):(y.removeClass("ta-readonly"),"textarea"===y[0].tagName.toLowerCase()||"input"===y[0].tagName.toLowerCase()?y.removeAttr("disabled"):a&&y.attr("contenteditable","true"),angular.forEach(U,function(e){y.find(e).off("click",p)}),y.on("drop",D)),u=e)})),a&&!u&&(angular.forEach(U,function(e){y.find(e).on("click",p)}),y.on("drop",D))}}}]);var oe=!1,e=angular.module("textAngular",["ngSanitize","textAngularSetup","textAngular.factories","textAngular.DOM","textAngular.validators","textAngular.taBind"]);return e.config([function(){angular.forEach(n,function(e,t){delete n[t]})}]),e.directive("textAngular",["$compile","$timeout","taOptions","taSelection","taExecCommand","textAngularManager","$document","$animate","$log","$q","$parse",function(h,v,y,b,x,E,S,w,T,C,N){return{require:"?ngModel",scope:{},restrict:"EA",priority:2,link:function(s,t,d,n){function a(e,t,n){v(function(){e.one(t,n)},100)}var e,o,r,l,i,u=d.serial||Math.floor(1e16*Math.random()),c=(s._name=d.name||"textAngularEditor"+u,x(d.taDefaultWrap));if(angular.extend(s,angular.copy(y),{wrapSelection:function(e,t,n){"undo"===e.toLowerCase()?s["$undoTaBindtaTextElement"+u]():"redo"===e.toLowerCase()?s["$redoTaBindtaTextElement"+u]():(c(e,!1,t,s.defaultTagAttributes),n&&s["reApplyOnSelectorHandlerstaTextElement"+u](),s.displayElements.text[0].focus())},showHtml:s.$eval(d.taShowHtml)||!1}),d.taFocussedClass&&(s.classes.focussed=d.taFocussedClass),d.taTextEditorClass&&(s.classes.textEditor=d.taTextEditorClass),d.taHtmlEditorClass&&(s.classes.htmlEditor=d.taHtmlEditorClass),d.taDefaultTagAttributes)try{angular.extend(s.defaultTagAttributes,angular.fromJson(d.taDefaultTagAttributes))}catch(e){T.error(e)}d.taTextEditorSetup&&(s.setup.textEditorSetup=s.$parent.$eval(d.taTextEditorSetup)),d.taHtmlEditorSetup&&(s.setup.htmlEditorSetup=s.$parent.$eval(d.taHtmlEditorSetup)),d.taFileDrop?s.fileDropHandler=s.$parent.$eval(d.taFileDrop):s.fileDropHandler=s.defaultFileDropHandler,e=t[0].innerHTML,t[0].innerHTML="",s.displayElements={forminput:angular.element("<input type='hidden' tabindex='-1' style='display: none;'>"),html:angular.element("<textarea></textarea>"),text:angular.element("<div></div>"),scrollWindow:angular.element("<div class='ta-scroll-window'></div>"),popover:angular.element('<div class="popover fade bottom" style="max-width: none; width: 305px;"></div>'),popoverArrow:angular.element('<div class="arrow"></div>'),popoverContainer:angular.element('<div class="popover-content"></div>'),resize:{overlay:angular.element('<div class="ta-resizer-handle-overlay"></div>'),background:angular.element('<div class="ta-resizer-handle-background"></div>'),anchors:[angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tr"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-bl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-br"></div>')],info:angular.element('<div class="ta-resizer-handle-info"></div>')}},s.displayElements.popover.append(s.displayElements.popoverArrow),s.displayElements.popover.append(s.displayElements.popoverContainer),s.displayElements.scrollWindow.append(s.displayElements.popover),s.displayElements.popover.on("mousedown",function(e,t){return t&&angular.extend(e,t),e.preventDefault(),!1}),s.handlePopoverEvents=function(){"block"===s.displayElements.popover.css("display")&&(i&&v.cancel(i),i=v(function(){s.reflowPopover(s.resizeElement),s.reflowResizeOverlay(s.resizeElement)},100))},angular.element(window).on("resize",s.handlePopoverEvents),angular.element(window).on("scroll",s.handlePopoverEvents);function p(e,t){t!==S[0].queryCommandState(e)&&S[0].execCommand(e,!1,null)}s.getScrollTop=function(e,t){var n=e.scrollTop;return void 0===n&&(n=0),t&&function(e){var t={vertical:!1,horizontal:!1};try{if(null===(n=window.getComputedStyle(e)))return t}catch(e){return t}var t=n["overflow-y"],n=n["overflow-x"];return{vertical:("scroll"===t||"auto"===t)&&e.scrollHeight>e.clientHeight,horizontal:("scroll"===n||"auto"===n)&&e.scrollWidth>e.clientWidth}}(e).vertical&&(e.removeEventListener("scroll",s._scrollListener,!1),e.addEventListener("scroll",s._scrollListener,!1)),0!==n?{node:e.nodeName,top:n}:e.parentNode?s.getScrollTop(e.parentNode,t):{node:"<none>",top:0}},s.showPopover=function(e){s.getScrollTop(s.displayElements.scrollWindow[0],!0),s.displayElements.popover.css("display","block"),v(function(){s.displayElements.resize.overlay.css("display","block")}),s.resizeElement=e,s.reflowPopover(e),w.addClass(s.displayElements.popover,"in"),a(S.find("body"),"click keyup",function(){s.hidePopover()})},s._scrollListener=function(e,t){s.handlePopoverEvents()},s.reflowPopover=function(e){var t=s.getScrollTop(s.displayElements.scrollWindow[0],!1),t=(e[0].offsetTop-t.top<51?(s.displayElements.popover.css("top",e[0].offsetTop+e[0].offsetHeight+s.displayElements.scrollWindow[0].scrollTop+"px"),s.displayElements.popover.removeClass("top").addClass("bottom")):(s.displayElements.popover.css("top",e[0].offsetTop-54+s.displayElements.scrollWindow[0].scrollTop+"px"),s.displayElements.popover.removeClass("bottom").addClass("top")),s.displayElements.text[0].offsetWidth-s.displayElements.popover[0].offsetWidth),e=e[0].offsetLeft+e[0].offsetWidth/2-s.displayElements.popover[0].offsetWidth/2,n=Math.max(0,Math.min(t,e)),e=Math.min(e,Math.max(0,e-t))-11;n+=window.scrollX,e-=window.scrollX,s.displayElements.popover.css("left",n+"px"),s.displayElements.popoverArrow.css("margin-left",e+"px")},s.hidePopover=function(){s.displayElements.popover.css("display","none"),s.displayElements.popoverContainer.attr("style",""),s.displayElements.popoverContainer.attr("class","popover-content"),s.displayElements.popover.removeClass("in"),s.displayElements.resize.overlay.css("display","none")},s.displayElements.resize.overlay.append(s.displayElements.resize.background),angular.forEach(s.displayElements.resize.anchors,function(e){s.displayElements.resize.overlay.append(e)}),s.displayElements.resize.overlay.append(s.displayElements.resize.info),s.displayElements.scrollWindow.append(s.displayElements.resize.overlay),s.displayElements.resize.background.on("click",function(e){s.displayElements.text[0].focus()}),s.reflowResizeOverlay=function(e){e=angular.element(e)[0],s.displayElements.resize.overlay.css({display:"block",left:e.offsetLeft-5+"px",top:e.offsetTop-5+"px",width:e.offsetWidth+10+"px",height:e.offsetHeight+10+"px"}),s.displayElements.resize.info.text(e.offsetWidth+" x "+e.offsetHeight)},s.showResizeOverlay=function(i){var n=S.find("body");r=function(e){function t(e){var t={x:Math.max(0,r.width+(e.clientX-r.x)),y:Math.max(0,r.height+(e.clientY-r.y))},n=void 0!==d.taResizeForceAspectRatio,a=d.taResizeMaintainAspectRatio;function o(e){return Math.round(Math.max(0,e))}(n||a&&!e.shiftKey)&&(n=t.y/t.x,t.x=n<l?t.x:t.y/l,t.y=n<l?t.x*l:t.y),(a=angular.element(i)).css("height",o(t.y)+"px"),a.css("width",o(t.x)+"px"),s.reflowResizeOverlay(i)}var r={width:parseInt(i.attr("width")),height:parseInt(i.attr("height")),x:e.clientX,y:e.clientY},l=(void 0!==r.width&&!isNaN(r.width)||(r.width=i[0].offsetWidth),void 0!==r.height&&!isNaN(r.height)||(r.height=i[0].offsetHeight),s.hidePopover(),r.height/r.width);n.on("mousemove",t),a(n,"mouseup",function(e){e.preventDefault(),e.stopPropagation(),n.off("mousemove",t),s.$apply(function(){s.hidePopover(),s.updateTaBindtaTextElement()},100)}),e.stopPropagation(),e.preventDefault()},s.displayElements.resize.anchors[3].off("mousedown"),s.displayElements.resize.anchors[3].on("mousedown",r),s.reflowResizeOverlay(i),a(n,"click",function(){s.hideResizeOverlay()})},s.hideResizeOverlay=function(){s.displayElements.resize.anchors[3].off("mousedown",r),s.displayElements.resize.overlay.css("display","none")},s.setup.htmlEditorSetup(s.displayElements.html),s.setup.textEditorSetup(s.displayElements.text),s.displayElements.html.attr({id:"taHtmlElement"+u,"ng-show":"showHtml","ta-bind":"ta-bind","ng-model":"html","ng-model-options":t.attr("ng-model-options")}),s.displayElements.text.attr({id:"taTextElement"+u,contentEditable:"true","ta-bind":"ta-bind","ng-model":"html","ng-model-options":t.attr("ng-model-options")}),s.displayElements.scrollWindow.attr({"ng-hide":"showHtml"}),d.taDefaultWrap&&s.displayElements.text.attr("ta-default-wrap",d.taDefaultWrap),d.taKeepStyles&&(s.displayElements.text.attr("ta-keep-styles",d.taKeepStyles),s.displayElements.html.attr("ta-keep-styles",d.taKeepStyles)),s.displayElements.scrollWindow.append(s.displayElements.text),t.append(s.displayElements.scrollWindow),t.append(s.displayElements.html),s.displayElements.forminput.attr("name",s._name),t.append(s.displayElements.forminput),d.tabindex&&(t.removeAttr("tabindex"),s.displayElements.text.attr("tabindex",d.tabindex),s.displayElements.html.attr("tabindex",d.tabindex)),d.placeholder&&(s.displayElements.text.attr("placeholder",d.placeholder),s.displayElements.html.attr("placeholder",d.placeholder)),d.taDisabled&&(s.displayElements.text.attr("ta-readonly","disabled"),s.displayElements.html.attr("ta-readonly","disabled"),s.disabled=s.$parent.$eval(d.taDisabled),s.$parent.$watch(d.taDisabled,function(e){s.disabled=e,s.disabled?t.addClass(s.classes.disabled):t.removeClass(s.classes.disabled)})),d.taPaste&&(s._pasteHandler=function(e){return N(d.taPaste)(s.$parent,{$html:e})},s.displayElements.text.attr("ta-paste","_pasteHandler($html)")),h(s.displayElements.scrollWindow)(s),h(s.displayElements.html)(s),s.updateTaBindtaTextElement=s["updateTaBindtaTextElement"+u],s.updateTaBindtaHtmlElement=s["updateTaBindtaHtmlElement"+u],t.addClass("ta-root"),s.displayElements.scrollWindow.addClass("ta-text ta-editor "+s.classes.textEditor),s.displayElements.html.addClass("ta-html ta-editor "+s.classes.htmlEditor);var f,m,g=s._actionRunning=!1;s.startAction=function(){var e,t,n,a;return s._actionRunning=!0,e=S[0].queryCommandState("bold"),t=S[0].queryCommandState("italic"),n=S[0].queryCommandState("underline"),a=S[0].queryCommandState("strikeThrough"),g=Q.saveSelection(),p("bold",e),p("italic",t),p("underline",n),p("strikeThrough",a),function(){g&&Q.restoreSelection(g)}},s.endAction=function(){s._actionRunning=!1,g&&((s.showHtml?s.displayElements.html:s.displayElements.text)[0].focus(),Q.removeMarkers(g)),g=!1,s.updateSelectedStyles(),s.showHtml||s["updateTaBindtaTextElement"+u]()},s.displayElements.html.on("focus",m=function(e){s.focussed=!0,t.addClass(s.classes.focussed),o.focus(),t.triggerHandler("focus"),s.updateSelectedStyles&&!s._bUpdateSelectedStyles&&v(function(){s.updateSelectedStyles()},0)}),s.displayElements.text.on("focus",m),s.displayElements.html.on("blur",m=function(e){return s._actionRunning||S[0].activeElement===s.displayElements.html[0]||S[0].activeElement===s.displayElements.text[0]||(t.removeClass(s.classes.focussed),o.unfocus(),v(function(){s._bUpdateSelectedStyles=!1,t.triggerHandler("blur"),s.focussed=!1},0)),e.preventDefault(),!1}),s.displayElements.text.on("blur",m),s.displayElements.text.on("paste",function(e){t.triggerHandler("paste",e)}),s.queryFormatBlockState=function(e){return!s.showHtml&&e.toLowerCase()===S[0].queryCommandValue("formatBlock").toLowerCase()},s.queryCommandState=function(e){return s.showHtml?"":S[0].queryCommandState(e)},s.switchView=function(){s.showHtml=!s.showHtml,w.enabled(!1,s.displayElements.html),w.enabled(!1,s.displayElements.text),s.showHtml?v(function(){return w.enabled(!0,s.displayElements.html),w.enabled(!0,s.displayElements.text),s.displayElements.html[0].focus()},100):v(function(){return w.enabled(!0,s.displayElements.html),w.enabled(!0,s.displayElements.text),s.displayElements.text[0].focus()},100)},d.ngModel?(f=!0,n.$render=function(){f&&(f=!1,null==s.$parent.$eval(d.ngModel)&&e&&""!==e&&n.$setViewValue(e)),s.displayElements.forminput.val(n.$viewValue),s.html=n.$viewValue||""},t.attr("required")&&(n.$validators.required=function(e,t){e=e||t;return!(!e||""===e.trim())})):(s.displayElements.forminput.val(e),s.html=e),s.$watch("html",function(e,t){e!==t&&(d.ngModel&&n.$viewValue!==e&&n.$setViewValue(e),s.displayElements.forminput.val(e))}),o=d.taTargetToolbars?E.registerEditor(s._name,s,d.taTargetToolbars.split(",")):(m=angular.element('<div text-angular-toolbar name="textAngularToolbar'+u+'">'),d.taToolbar&&m.attr("ta-toolbar",d.taToolbar),d.taToolbarClass&&m.attr("ta-toolbar-class",d.taToolbarClass),d.taToolbarGroupClass&&m.attr("ta-toolbar-group-class",d.taToolbarGroupClass),d.taToolbarButtonClass&&m.attr("ta-toolbar-button-class",d.taToolbarButtonClass),d.taToolbarActiveButtonClass&&m.attr("ta-toolbar-active-button-class",d.taToolbarActiveButtonClass),d.taFocussedClass&&m.attr("ta-focussed-class",d.taFocussedClass),t.prepend(m),h(m)(s.$parent),E.registerEditor(s._name,s,["textAngularToolbar"+u])),s.$on("$destroy",function(){E.unregisterEditor(s._name),angular.element(window).off("blur"),angular.element(window).off("resize",s.handlePopoverEvents),angular.element(window).off("scroll",s.handlePopoverEvents)}),s.$on("ta-element-select",function(e,t){o.triggerElementSelect(e,t)&&s["reApplyOnSelectorHandlerstaTextElement"+u]()}),s.$on("ta-drop-event",function(e,t,n,a){a&&a.files&&0<a.files.length?(s.displayElements.text[0].focus(),b.setSelectionToElementEnd(n.target),angular.forEach(a.files,function(e){try{C.when(s.fileDropHandler(e,s.wrapSelection)||s.fileDropHandler!==s.defaultFileDropHandler&&C.when(s.defaultFileDropHandler(e,s.wrapSelection))).then(function(){s["updateTaBindtaTextElement"+u]()})}catch(e){T.error(e)}}),n.preventDefault(),n.stopPropagation()):v(function(){s["updateTaBindtaTextElement"+u]()},0)}),s._bUpdateSelectedStyles=!1,angular.element(window).on("blur",function(){s._bUpdateSelectedStyles=!1,s.focussed=!1}),s.updateSelectedStyles=function(){var e;l&&v.cancel(l),void 0!==(e=b.getSelectionElement())&&e.parentNode!==s.displayElements.text[0]?o.updateSelectedStyles(angular.element(e)):o.updateSelectedStyles(),s._bUpdateSelectedStyles&&(l=v(s.updateSelectedStyles,200))},s.displayElements.html.on("keydown",m=function(){s.focussed?s._bUpdateSelectedStyles||(s._bUpdateSelectedStyles=!0,s.$apply(function(){s.updateSelectedStyles()})):s._bUpdateSelectedStyles=!1}),s.displayElements.text.on("keydown",m),s.displayElements.html.on("keyup",m=function(){s._bUpdateSelectedStyles=!1}),s.displayElements.text.on("keyup",m),s.displayElements.html.on("keypress",m=function(e,t){var n;b.getSelection&&(n=b.getSelection(),b.getSelectionElement()&&"a"===b.getSelectionElement().nodeName.toLowerCase()&&(3===n.start.element.nodeType&&n.start.element.textContent.length===n.end.offset&&b.setSelectionAfterElement(b.getSelectionElement()),3===n.start.element.nodeType&&0===n.start.offset&&b.setSelectionBeforeElement(b.getSelectionElement()))),t&&angular.extend(e,t),s.$apply(function(){if(o.sendKeyCommand(e))return s._bUpdateSelectedStyles||s.updateSelectedStyles(),e.preventDefault(),!1})}),s.displayElements.text.on("keypress",m),s.displayElements.html.on("mouseup",m=function(){s._bUpdateSelectedStyles=!1,v(function(){s.updateSelectedStyles()},0)}),s.displayElements.text.on("mouseup",m)}}}]),e.service("textAngularManager",["taToolExecuteAction","taTools","taRegisterTool","$interval","$rootScope","$log",function(r,f,l,e,t,n){function i(){Math.abs(Date.now()-o)>u&&(o=Date.now(),a=e(function(){d(),a=void 0},u,1))}var a,s={},m={},o=0,d=function(t){angular.forEach(m,function(e){e.editorFunctions.updateSelectedStyles(t)})},u=50;t.$on("destroy",function(){a&&(e.cancel(a),a=void 0)});return{registerEditor:function(c,p,e){if(!c||""===c)throw"textAngular Error: An editor requires a name";if(!p)throw"textAngular Error: An editor requires a scope";if(m[c])throw'textAngular Error: An Editor with name "'+c+'" already exists';return m[c]={scope:p,toolbars:e,toolbarScopes:[],_registerToolbarScope:function(e){0<=this.toolbars.indexOf(e.name)&&this.toolbarScopes.push(e)},editorFunctions:{disable:function(){angular.forEach(m[c].toolbarScopes,function(e){e.disabled=!0})},enable:function(){angular.forEach(m[c].toolbarScopes,function(e){e.disabled=!1})},focus:function(){angular.forEach(m[c].toolbarScopes,function(e){e._parent=p,e.disabled=!1,e.focussed=!0}),p.focussed=!0},unfocus:function(){angular.forEach(m[c].toolbarScopes,function(e){e.disabled=!0,e.focussed=!1}),p.focussed=!1},updateSelectedStyles:function(n){angular.forEach(m[c].toolbarScopes,function(t){angular.forEach(t.tools,function(e){e.activeState&&(t._parent=p,e.active=e.activeState(n))})})},sendKeyCommand:function(a){var o=!1;return(a.ctrlKey||a.metaKey||a.specialKey)&&angular.forEach(f,function(e,t){if(e.commandKeyCode&&(e.commandKeyCode===a.which||e.commandKeyCode===a.specialKey))for(var n=0;n<m[c].toolbarScopes.length;n++)if(void 0!==m[c].toolbarScopes[n].tools[t]){r.call(m[c].toolbarScopes[n].tools[t],p),o=!0;break}}),o},triggerElementSelect:function(e,n){function a(e,t){for(var n=!0,a=0;a<t.length;a++)n=n&&e.attr(t[a]);return n}var o=[],r={},t=!1,l=(n=angular.element(n),!1);if(angular.forEach(f,function(e,t){e.onElementSelect&&e.onElementSelect.element&&e.onElementSelect.element.toLowerCase()===n[0].tagName.toLowerCase()&&(!e.onElementSelect.filter||e.onElementSelect.filter(n))&&(l=l||angular.isArray(e.onElementSelect.onlyWithAttrs)&&a(n,e.onElementSelect.onlyWithAttrs),e.onElementSelect.onlyWithAttrs&&!a(n,e.onElementSelect.onlyWithAttrs)||(r[t]=e))}),l?(angular.forEach(r,function(e,t){e.onElementSelect.onlyWithAttrs&&a(n,e.onElementSelect.onlyWithAttrs)&&o.push({name:t,tool:e})}),o.sort(function(e,t){return t.tool.onElementSelect.onlyWithAttrs.length-e.tool.onElementSelect.onlyWithAttrs.length})):angular.forEach(r,function(e,t){o.push({name:t,tool:e})}),0<o.length)for(var i=0;i<o.length;i++){for(var s=o[i].tool,d=o[i].name,u=0;u<m[c].toolbarScopes.length;u++)if(void 0!==m[c].toolbarScopes[u].tools[d]){s.onElementSelect.action.call(m[c].toolbarScopes[u].tools[d],e,n,p),t=!0;break}if(t)break}return t}}},angular.forEach(e,function(e){s[e]&&m[c].toolbarScopes.push(s[e])}),i(),m[c].editorFunctions},retrieveEditor:function(e){return m[e]},unregisterEditor:function(e){delete m[e],i()},registerToolbar:function(t){if(!t)throw"textAngular Error: A toolbar requires a scope";if(!t.name||""===t.name)throw"textAngular Error: A toolbar requires a name";if(s[t.name])throw'textAngular Error: A toolbar with name "'+t.name+'" already exists';s[t.name]=t,angular.forEach(m,function(e){e._registerToolbarScope(t)}),i()},retrieveToolbar:function(e){return s[e]},retrieveToolbarsViaEditor:function(e){var t=[],n=this;return angular.forEach(this.retrieveEditor(e).toolbars,function(e){t.push(n.retrieveToolbar(e))}),t},unregisterToolbar:function(e){delete s[e],i()},updateToolsDisplay:function(e){var n=this;angular.forEach(e,function(e,t){n.updateToolDisplay(t,e)})},resetToolsDisplay:function(){var n=this;angular.forEach(f,function(e,t){n.resetToolDisplay(t)}),i()},updateToolDisplay:function(n,a){var o=this;angular.forEach(s,function(e,t){o.updateToolbarToolDisplay(t,n,a)}),i()},resetToolDisplay:function(n){var a=this;angular.forEach(s,function(e,t){a.resetToolbarToolDisplay(t,n)}),i()},updateToolbarToolDisplay:function(e,t,n){if(!s[e])throw'textAngular Error: No Toolbar with name "'+e+'" exists';s[e].updateToolDisplay(t,n)},resetToolbarToolDisplay:function(e,t){if(!s[e])throw'textAngular Error: No Toolbar with name "'+e+'" exists';s[e].updateToolDisplay(t,f[t],!0)},removeTool:function(o){delete f[o],angular.forEach(s,function(e){delete e.tools[o];for(var t=0;t<e.toolbar.length;t++){for(var n,a=0;a<e.toolbar[t].length;a++){if(e.toolbar[t][a]===o){n={group:t,index:a};break}if(void 0!==n)break}void 0!==n&&(e.toolbar[n.group].slice(n.index,1),e._$element.children().eq(n.group).children().eq(n.index).remove())}}),i()},addTool:function(t,n,a,o){l(t,n),angular.forEach(s,function(e){e.addTool(t,n,a,o)}),i()},addToolToToolbar:function(e,t,n,a,o){l(e,t),s[n].addTool(e,t,a,o),i()},refreshEditor:function(e){if(!m[e])throw'textAngular Error: No Editor with name "'+e+'" exists';m[e].scope.updateTaBindtaTextElement(),m[e].scope.$$phase||m[e].scope.$digest(),i()},sendKeyCommand:function(e,t){var n=m[e._name];if(n&&n.editorFunctions.sendKeyCommand(t))return e._bUpdateSelectedStyles||e.updateSelectedStyles(),t.preventDefault(),!1},updateStyles:d,getVersion:function(){return"v1.5.16"},getToolbarScopes:function(){var t=[];return angular.forEach(m,function(e){t=t.concat(e.toolbarScopes)}),t}}}]),e.directive("textAngularToolbar",["$compile","textAngularManager","taOptions","taTools","taToolExecuteAction","$window",function(d,t,n,u,a,o){return{scope:{name:"@"},restrict:"EA",link:function(r,l,e){if(!r.name||""===r.name)throw"textAngular Error: A toolbar requires a name";angular.extend(r,angular.copy(n)),e.taToolbar&&(r.toolbar=r.$parent.$eval(e.taToolbar)),e.taToolbarClass&&(r.classes.toolbar=e.taToolbarClass),e.taToolbarGroupClass&&(r.classes.toolbarGroup=e.taToolbarGroupClass),e.taToolbarButtonClass&&(r.classes.toolbarButton=e.taToolbarButtonClass),e.taToolbarActiveButtonClass&&(r.classes.toolbarButtonActive=e.taToolbarActiveButtonClass),e.taFocussedClass&&(r.classes.focussed=e.taFocussedClass),r.disabled=!0,r.focussed=!1,(r._$element=l)[0].innerHTML="",l.addClass("ta-toolbar "+r.classes.toolbar),r.$watch("focussed",function(){r.focussed?l.addClass(r.classes.focussed):l.removeClass(r.classes.focussed)});function i(e,t){var n,a,o=e&&e.display?angular.element(e.display):angular.element("<button type='button'>");return e&&e.class?o.addClass(e.class):o.addClass(r.classes.toolbarButton),o.attr("name",t.name),o.attr("ta-button","ta-button"),o.attr("ng-disabled","isDisabled()"),o.attr("tabindex","-1"),o.attr("ng-click","executeAction()"),o.attr("ng-class","displayActiveToolClass(active)"),e&&e.tooltiptext&&o.attr("title",e.tooltiptext),!e||e.display||t._display||(o[0].innerHTML="",e.buttontext&&(o[0].innerHTML=e.buttontext),e.iconclass&&(n=angular.element("<i>"),a=o[0].innerHTML,n.addClass(e.iconclass),n[0].innerHTML=e.iconinnerhtml||"",o[0].innerHTML="",o.append(n),a&&""!==a&&o.append("&nbsp;"+a))),t._lastToolDefinition=angular.copy(e),d(o)(t)}r.tools={},r._parent={disabled:!0,showHtml:!1,queryFormatBlockState:function(){return!1},queryCommandState:function(){return!1}};var s={$window:o,$editor:function(){return r._parent},isDisabled:function(){return("html"!==this.name||!r._parent.startAction)&&("function"!=typeof this.$eval("disabled")&&this.$eval("disabled")||this.$eval("disabled()")||"html"!==this.name&&this.$editor().showHtml||this.$parent.disabled||this.$editor().disabled)},displayActiveToolClass:function(e){return e?r.classes.toolbarButtonActive:""},executeAction:a};angular.forEach(r.toolbar,function(e){var t=angular.element("<div>");t.addClass(r.classes.toolbarGroup),angular.forEach(e,function(e){r.tools[e]=angular.extend(r.$new(!0),u[e],s,{name:e}),r.tools[e].$element=i(u[e],r.tools[e]),t.append(r.tools[e].$element)}),l.append(t)}),r.updateToolDisplay=function(e,t,n){var a=r.tools[e];if(a){if(null===(t=a._lastToolDefinition&&!n?angular.extend({},a._lastToolDefinition,t):t).buttontext&&null===t.iconclass&&null===t.display)throw'textAngular Error: Tool Definition for updating "'+e+'" does not have a valid display/iconclass/buttontext value';null===t.buttontext&&delete t.buttontext,null===t.iconclass&&delete t.iconclass,null===t.display&&delete t.display;n=i(t,a);a.$element.replaceWith(n),a.$element=n}},r.addTool=function(e,t,n,a){var o;r.tools[e]=angular.extend(r.$new(!0),u[e],s,{name:e}),r.tools[e].$element=i(u[e],r.tools[e]),void 0===n&&(n=r.toolbar.length-1),o=angular.element(l.children()[n]),void 0===a?(o.append(r.tools[e].$element),r.toolbar[n][r.toolbar[n].length-1]=e):(o.children().eq(a).after(r.tools[e].$element),r.toolbar[n][a]=e)},t.registerToolbar(r),r.$on("$destroy",function(){t.unregisterToolbar(r.name)})}}}]),e.directive("textAngularVersion",["textAngularManager",function(e){var a=e.getVersion();return{restrict:"EA",link:function(e,t,n){t.html(a)}}}]),e.name});